<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××©×—×§ ×œ×™××•×“ ×× ×’×œ×™×ª - ×¢×™×“×Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            direction: rtl;
            overflow-x: hidden;
        }

        /* ×× ×™××¦×™×•×ª ×“×•××•×œ×™× ×’×• */
        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3) translateY(-20px);
            }
            50% {
                opacity: 0.9;
                transform: scale(1.05) translateY(0);
            }
            80% {
                opacity: 1;
                transform: scale(0.95) translateY(0);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        @keyframes slideInRight {
            0% {
                opacity: 0;
                transform: translateX(100px);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInLeft {
            0% {
                opacity: 0;
                transform: translateX(-100px);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeInUp {
            0% {
                opacity: 0;
                transform: translateY(30px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }

        @keyframes correctAnswer {
            0% {
                background: linear-gradient(145deg, #ffffff 0%, #f5f5f5 100%);
                transform: scale(1);
            }
            50% {
                background: linear-gradient(145deg, #c8e6c9 0%, #4CAF50 100%);
                transform: scale(1.1);
            }
            100% {
                background: linear-gradient(145deg, #c8e6c9 0%, #4CAF50 100%);
                transform: scale(1);
            }
        }

        @keyframes wrongAnswer {
            0% {
                background: linear-gradient(145deg, #ffffff 0%, #f5f5f5 100%);
                transform: translateX(0);
            }
            25% {
                background: linear-gradient(145deg, #ffcdd2 0%, #f44336 100%);
                transform: translateX(-10px);
            }
            75% {
                background: linear-gradient(145deg, #ffcdd2 0%, #f44336 100%);
                transform: translateX(10px);
            }
            100% {
                background: linear-gradient(145deg, #ffcdd2 0%, #f44336 100%);
                transform: translateX(0);
            }
        }

        @keyframes levelComplete {
            0% {
                opacity: 0;
                transform: scale(0.5) rotate(-10deg);
            }
            50% {
                opacity: 1;
                transform: scale(1.2) rotate(5deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }

        @keyframes starBurst {
            0% {
                opacity: 0;
                transform: scale(0) rotate(0deg);
            }
            50% {
                opacity: 1;
                transform: scale(1.5) rotate(180deg);
            }
            100% {
                opacity: 0;
                transform: scale(2) rotate(360deg);
            }
        }

        /* ×›×œ××¡ ×œ×× ×™××¦×™×•×ª */
        .animate-bounce-in {
            animation: bounceIn 0.6s ease-out;
        }

        .animate-slide-right {
            animation: slideInRight 0.5s ease-out;
        }

        .animate-slide-left {
            animation: slideInLeft 0.5s ease-out;
        }

        .animate-fade-up {
            animation: fadeInUp 0.4s ease-out;
        }

        .animate-pulse {
            animation: pulse 1s infinite;
        }

        .animate-correct {
            animation: correctAnswer 0.8s ease-out;
        }

        .animate-wrong {
            animation: wrongAnswer 0.6s ease-out;
        }

        .animate-level-complete {
            animation: levelComplete 1s ease-out;
        }

        .animate-star-burst {
            animation: starBurst 2s ease-out;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ×›×¤×ª×•×¨ ×”×—×œ×£ ××©×ª××© ×§×‘×•×¢ */
        .switch-user-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(145deg, #FF6B6B 0%, #FF5252 100%);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 20px;
            font-size: 0.9em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 15px rgba(255, 107, 107, 0.3);
            z-index: 1000;
            display: none;
        }

        .switch-user-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 20px rgba(255, 107, 107, 0.4);
        }

        .switch-user-btn.show {
            display: block;
        }

        /* ××¡×š ×‘×—×™×¨×ª ×©×—×§×Ÿ */
        .player-selection {
            background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 4px solid #4CAF50;
        }

        .player-selection h1 {
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .players-list {
            margin: 30px 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .player-card {
            background: linear-gradient(145deg, #f1f3f4 0%, #e8eaf6 100%);
            margin: 10px 0;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            border-color: #4CAF50;
        }

        .player-info h3 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .player-stats {
            font-size: 0.9em;
            color: #666;
        }

        .create-player-section {
            margin-top: 30px;
            padding: 20px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 15px;
            border: 2px dashed #4CAF50;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .input-group input {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.1em;
            text-align: center;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 15px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .btn-primary {
            background: linear-gradient(145deg, #4CAF50 0%, #45a049 100%);
            color: white;
            box-shadow: 0 8px 15px rgba(76, 175, 80, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 20px rgba(76, 175, 80, 0.4);
        }

        /* ××¡×š ×‘×—×™×¨×ª ×¨××•×ª */
        .level-selection {
            display: none;
            background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 4px solid #FF9800;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .category-card {
            background: linear-gradient(145deg, #fff3e0 0%, #ffe0b2 100%);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .category-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            border-color: #FF9800;
        }

        .category-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .levels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .level-card {
            background: linear-gradient(145deg, #e8f5e8 0%, #c8e6c9 100%);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 3px solid transparent;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .level-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(255,255,255,0.3) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .level-card:hover::before {
            opacity: 1;
        }

        .level-card.locked {
            background: linear-gradient(145deg, #f5f5f5 0%, #e0e0e0 100%);
            cursor: not-allowed;
            opacity: 0.6;
            filter: grayscale(70%);
        }

        .level-card.completed {
            background: linear-gradient(145deg, #fff9c4 0%, #fff176 100%);
            border-color: #FFC107;
            box-shadow: 0 8px 25px rgba(255, 193, 7, 0.3);
        }

        .level-card.completed::after {
            content: 'â­';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5em;
            animation: pulse 2s infinite;
        }

        .level-card:not(.locked):hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.25);
            border-color: #4CAF50;
        }

        .level-card.current {
            border-color: #2196F3;
            background: linear-gradient(145deg, #e3f2fd 0%, #bbdefb 100%);
            animation: pulse 2s infinite;
        }

        .level-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .level-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .level-progress {
            font-size: 0.9em;
            color: #666;
            opacity: 0.8;
        }

        /* ××¡×š ×”××©×—×§ */
        .game-screen {
            display: none;
            background: linear-gradient(145deg, #fce4ec 0%, #f8bbd9 100%);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            border: 5px solid #4CAF50;
            text-align: center;
            position: relative;
        }

        .game-header {
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .progress-bar {
            background: #e0e0e0;
            border-radius: 20px;
            height: 20px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4CAF50 0%, #8BC34A 100%);
            height: 100%;
            border-radius: 20px;
            transition: width 0.5s ease;
        }

        .question-card {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 40px;
            margin: 30px 0;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            border: 3px solid #FF9800;
        }

        .word-image {
            width: 200px;
            height: 200px;
            border-radius: 20px;
            margin: 20px auto;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            border: 4px solid #4CAF50;
        }

        .hebrew-word {
            font-size: 3em;
            font-weight: bold;
            color: #2c3e50;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .answers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .answer-card {
            background: linear-gradient(145deg, #ffffff 0%, #f5f5f5 100%);
            border: 4px solid #ddd;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .answer-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s ease;
        }

        .answer-card:hover::before {
            left: 100%;
        }

        .answer-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 25px rgba(0,0,0,0.2);
            border-color: #4CAF50;
        }

        .answer-card:active {
            transform: translateY(-2px) scale(0.98);
        }

        .answer-card.correct {
            background: linear-gradient(145deg, #c8e6c9 0%, #4CAF50 100%);
            border-color: #2E7D32;
            color: white;
            animation: correctAnswer 0.8s ease-out;
        }

        .answer-card.wrong {
            background: linear-gradient(145deg, #ffcdd2 0%, #f44336 100%);
            border-color: #C62828;
            color: white;
            animation: wrongAnswer 0.6s ease-out;
        }

        /* ××¡×š ×‘×—×™×¨×ª ×¨××•×ª */
        .level-selection {
            display: none;
            background: linear-gradient(145deg, #fff3e0 0%, #ffcc02 100%);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            border: 5px solid #4CAF50;
            text-align: center;
        }

        .answer-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            border-color: #4CAF50;
            background: linear-gradient(145deg, #e8f5e8 0%, #c8e6c9 100%);
        }

        .answer-card.correct {
            background: linear-gradient(145deg, #c8e6c9 0%, #4CAF50 100%);
            border-color: #2E7D32;
            color: white;
            animation: correctPulse 0.6s ease;
        }

        .answer-card.wrong {
            background: linear-gradient(145deg, #ffcdd2 0%, #f44336 100%);
            border-color: #c62828;
            color: white;
            animation: wrongShake 0.6s ease;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .result-screen {
            display: none;
            background: linear-gradient(145deg, #fff9c4 0%, #fff176 100%);
            border-radius: 25px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            border: 5px solid #FFC107;
        }

        .result-emoji {
            font-size: 5em;
            margin-bottom: 20px;
        }

        .back-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            border: 2px solid #ddd;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: #f44336;
            color: white;
            border-color: #c62828;
        }

        /* ×”×•×“×¢×•×ª */
        .message {
            padding: 15px;
            margin: 20px 0;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }

        /* ×¨×¡×¤×•× ×¡×™×‘×™ */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .player-selection,
            .level-selection,
            .game-screen,
            .result-screen {
                padding: 20px;
                margin: 10px;
            }
            
            .hebrew-word {
                font-size: 2em;
            }
            
            .categories-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }
            
            .answers-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        /* ×¢××•×“ ×˜×¢×™× ×” */
        .loading {
            display: none;
            text-align: center;
            padding: 50px;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- ×›×¤×ª×•×¨ ×”×—×œ×£ ××©×ª××© ×§×‘×•×¢ -->
    <button id="switchUserBtn" class="switch-user-btn" onclick="goToPlayerSelection()">
        ğŸ‘¤ ×”×—×œ×£ ××©×ª××©
    </button>

    <div class="container">
        <!-- ××¡×š ×‘×—×™×¨×ª ×©×—×§×Ÿ -->
        <div id="playerSelection" class="player-selection">
            <h1>ğŸ® ×‘×¨×•×›×™× ×”×‘××™× ×œ××©×—×§ ×× ×’×œ×™×ª! ğŸ®</h1>
            <p style="font-size: 1.2em; color: #666; margin-bottom: 30px;">×‘×—×¨×• ×©×—×§×Ÿ ××• ×¦×¨×• ×©×—×§×Ÿ ×—×“×©</p>
            
            <div class="players-list" id="playersList">
                <!-- ×¨×©×™××ª ×”×©×—×§× ×™× ×ª×™×˜×¢×Ÿ ×›××Ÿ -->
            </div>
            
            <div class="create-player-section">
                <h3>ğŸŒŸ ×™×¦×™×¨×ª ×©×—×§×Ÿ ×—×“×© ğŸŒŸ</h3>
                <div class="input-group">
                    <input type="text" id="newPlayerName" placeholder="×”×–×™× ×• ×©× ×”×©×—×§×Ÿ ×”×—×“×©..." maxlength="20">
                    <button class="btn btn-primary" onclick="createNewPlayer()">×™×¦×™×¨×ª ×©×—×§×Ÿ</button>
                </div>
            </div>
        </div>

        <!-- ××¡×š ×‘×—×™×¨×ª ×¨××•×ª -->
        <div id="levelSelection" class="level-selection">
            <button class="back-btn" onclick="goToPlayerSelection()">ğŸ </button>
            <div class="game-header">
                <h2 id="playerGreeting">×©×œ×•×, ×©×—×§×Ÿ!</h2>
                <p id="playerStats">×¦×™×•×Ÿ ×›×•×œ×œ: 0 | ××©×—×§×™×: 0</p>
            </div>
            
            <h2 style="text-align: center; color: #FF9800; margin-bottom: 20px;">×‘×—×¨×• ×§×˜×’×•×¨×™×” ×•×¨××”</h2>
            
            <!-- ×›×¤×ª×•×¨×™ ×”×¡×‘×¨×™× ×•×ª×¨×’×•× -->
            <div style="text-align: center; margin-bottom: 20px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                <button onclick="showTranslatorHebEng()" class="btn btn-translator" style="background: linear-gradient(145deg, #4CAF50 0%, #45a049 100%); color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 1.1em; cursor: pointer; box-shadow: 0 8px 15px rgba(76, 175, 80, 0.3);">
                    ğŸ‡®ğŸ‡±â¡ï¸ğŸ‡ºğŸ‡¸ ×¢×‘×¨×™×ª ×œ×× ×’×œ×™×ª
                </button>
                <button onclick="showExplanations()" class="btn btn-info" style="background: linear-gradient(145deg, #2196F3 0%, #1976D2 100%); color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 1.1em; cursor: pointer; box-shadow: 0 8px 15px rgba(33, 150, 243, 0.3);">
                    ğŸ“– ×”×¡×‘×¨×™ ×“×§×“×•×§
                </button>
                <button onclick="showTranslatorEngHeb()" class="btn btn-translator" style="background: linear-gradient(145deg, #FF9800 0%, #F57C00 100%); color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 1.1em; cursor: pointer; box-shadow: 0 8px 15px rgba(255, 152, 0, 0.3);">
                    ğŸ‡ºğŸ‡¸â¡ï¸ğŸ‡®ğŸ‡± ×× ×’×œ×™×ª ×œ×¢×‘×¨×™×ª
                </button>
            </div>
            
            <div class="categories-grid">
                <!-- ×§×˜×’×•×¨×™×•×ª ××™×œ×™× -->
                <div class="category-card" onclick="selectCategory('animals')">
                    <div class="category-icon">ğŸ¾</div>
                    <h3>×—×™×•×ª</h3>
                    <p>12 ××™×œ×™×, 10 ×¨××•×ª</p>
                </div>
                <div class="category-card" onclick="selectCategory('colors')">
                    <div class="category-icon">ğŸ¨</div>
                    <h3>×¦×‘×¢×™×</h3>
                    <p>12 ××™×œ×™×, 10 ×¨××•×ª</p>
                </div>
                <div class="category-card" onclick="selectCategory('food')">
                    <div class="category-icon">ğŸ•</div>
                    <h3>××•×›×œ</h3>
                    <p>12 ××™×œ×™×, 10 ×¨××•×ª</p>
                </div>
                <div class="category-card" onclick="selectCategory('family')">
                    <div class="category-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
                    <h3>××©×¤×—×”</h3>
                    <p>12 ××™×œ×™×, 10 ×¨××•×ª</p>
                </div>
                <div class="category-card" onclick="selectCategory('verbs')">
                    <div class="category-icon">ğŸƒâ€â™‚ï¸</div>
                    <h3>×¤×¢×œ×™×</h3>
                    <p>12 ×¤×¢×œ×™×, 10 ×¨××•×ª</p>
                </div>
                
                <!-- ×§×˜×’×•×¨×™×•×ª ×“×§×“×•×§ -->
                <div class="category-card" style="border: 3px solid #FF6B6B;" onclick="selectCategory('present_simple')">
                    <div class="category-icon">ğŸ“</div>
                    <h3>×”×•×•×” ×¤×©×•×˜</h3>
                    <p>×“×§×“×•×§, 10 ×¨××•×ª</p>
                </div>
                <div class="category-card" style="border: 3px solid #FF6B6B;" onclick="selectCategory('present_progressive')">
                    <div class="category-icon">â°</div>
                    <h3>×”×•×•×” ××ª××©×š</h3>
                    <p>×“×§×“×•×§, 10 ×¨××•×ª</p>
                </div>
                <div class="category-card" style="border: 3px solid #FF6B6B;" onclick="selectCategory('questions')">
                    <div class="category-icon">â“</div>
                    <h3>××™×œ×•×ª ×©××œ×”</h3>
                    <p>×“×§×“×•×§, 10 ×¨××•×ª</p>
                </div>
            </div>
            
            <div id="levelsContainer" style="display: none;">
                <h3 id="selectedCategoryTitle">×¨××•×ª ×–××™× ×•×ª</h3>
                <div class="levels-grid" id="levelsGrid">
                    <!-- ×¨××•×ª ×™×˜×¢× ×• ×›××Ÿ -->
                </div>
            </div>
        </div>

        <!-- ××¡×š ×”××©×—×§ -->
        <div id="gameScreen" class="game-screen">
            <button class="back-btn" onclick="exitGame()">âŒ</button>
            
            <div class="game-header">
                <h2 id="gameTitle">××©×—×§ ×× ×’×œ×™×ª</h2>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                </div>
                <p id="gameProgress">×©××œ×” 0 ××ª×•×š 0 | ×¦×™×•×Ÿ: 0</p>
            </div>
            
            <div class="question-card">
                <img id="wordImage" class="word-image" src="" alt="×ª××•× ×”">
                <div id="hebrewWord" class="hebrew-word">×˜×•×¢×Ÿ...</div>
                <div class="answers-grid" id="answersGrid">
                    <!-- ×ª×©×•×‘×•×ª ×™×˜×¢× ×• ×›××Ÿ -->
                </div>
            </div>
        </div>

        <!-- ××¡×š ×ª×•×¦××•×ª -->
        <div id="resultScreen" class="result-screen">
            <div class="result-emoji" id="resultEmoji">ğŸ‰</div>
            <h2 id="resultTitle">×›×œ ×”×›×‘×•×“!</h2>
            <div id="resultStats">
                <p>×¦×™×•×Ÿ: <span id="finalScore">0</span></p>
                <p>×ª×©×•×‘×•×ª × ×›×•× ×•×ª: <span id="correctAnswers">0</span></p>
                <p>×“×¨×’×ª ×”×¦×œ×—×”: <span id="successRate">0%</span></p>
            </div>
            <div style="margin-top: 30px;">
                <button class="btn btn-primary" onclick="goToLevelSelection()">×‘×—×™×¨×ª ×¨××” ×—×“×©×”</button>
            </div>
        </div>

        <!-- ××¡×š ×”×¡×‘×¨×™× -->
        <div id="explanationsScreen" class="explanation-screen" style="display: none;">
            <button class="back-btn" onclick="goToLevelSelection()">ğŸ </button>
            
            <div class="explanation-header">
                <h2>ğŸ“– ×”×¡×‘×¨×™ ×“×§×“×•×§ ×× ×’×œ×™×ª</h2>
                <p>×‘×—×¨×• × ×•×©× ×œ×œ××™×“×” ××¢××™×§×”</p>
            </div>
            
            <div class="explanations-grid" id="explanationsGrid">
                <!-- ×”×¡×‘×¨×™× ×™×˜×¢× ×• ×›××Ÿ -->
            </div>
        </div>

        <!-- ××¡×š ×ª×¨×’×•× ×¢×‘×¨×™×ª ×œ×× ×’×œ×™×ª -->
        <div id="translatorHebEngScreen" class="translator-screen" style="display: none;">
            <button class="back-btn" onclick="goToLevelSelection()">ğŸ </button>
            
            <div class="translator-header">
                <h2>ğŸ‡®ğŸ‡±â¡ï¸ğŸ‡ºğŸ‡¸ ×ª×¨×’×•× ×¢×‘×¨×™×ª ×œ×× ×’×œ×™×ª</h2>
                <p>×”×–×™× ×• ××™×œ×” ××• ××©×¤×˜ ×‘×¢×‘×¨×™×ª ×œ×§×‘×œ×ª ×ª×¨×’×•× ×œ×× ×’×œ×™×ª</p>
            </div>
            
            <div class="translator-content">
                <div class="translator-input-section">
                    <label for="hebInput">×˜×§×¡×˜ ×‘×¢×‘×¨×™×ª:</label>
                    <textarea id="hebInput" placeholder="×”×–×™× ×• ×›××Ÿ ×˜×§×¡×˜ ×‘×¢×‘×¨×™×ª..." rows="4"></textarea>
                    <button onclick="translateHebToEng()" class="translate-btn">ğŸ”„ ×ª×¨×’×</button>
                </div>
                
                <div class="translator-output-section">
                    <label>×ª×¨×’×•× ×œ×× ×’×œ×™×ª:</label>
                    <div id="engOutput" class="translation-output">×”×ª×¨×’×•× ×™×•×¤×™×¢ ×›××Ÿ...</div>
                </div>
                
                <div class="quick-translate">
                    <h3>×ª×¨×’×•× ××”×™×¨ - ××™×œ×™× × ×¤×•×¦×•×ª:</h3>
                    <div class="quick-words-grid">
                        <button onclick="quickTranslate('×©×œ×•×', 'hello')">×©×œ×•× â†’ Hello</button>
                        <button onclick="quickTranslate('×ª×•×“×”', 'thank you')">×ª×•×“×” â†’ Thank you</button>
                        <button onclick="quickTranslate('×‘×‘×§×©×”', 'please')">×‘×‘×§×©×” â†’ Please</button>
                        <button onclick="quickTranslate('×¡×œ×™×—×”', 'excuse me')">×¡×œ×™×—×” â†’ Excuse me</button>
                        <button onclick="quickTranslate('×›×Ÿ', 'yes')">×›×Ÿ â†’ Yes</button>
                        <button onclick="quickTranslate('×œ×', 'no')">×œ× â†’ No</button>
                        <button onclick="quickTranslate('××•×¤× ×™×', 'bicycle')">××•×¤× ×™× â†’ Bicycle</button>
                        <button onclick="quickTranslate('×‘×™×ª ×¡×¤×¨', 'school')">×‘×™×ª ×¡×¤×¨ â†’ School</button>
                        <button onclick="quickTranslate('××™×', 'water')">××™× â†’ Water</button>
                        <button onclick="quickTranslate('××•×›×œ', 'food')">××•×›×œ â†’ Food</button>
                        <button onclick="quickTranslate('××©×¤×—×”', 'family')">××©×¤×—×” â†’ Family</button>
                        <button onclick="quickTranslate('×—×‘×¨', 'friend')">×—×‘×¨ â†’ Friend</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ××¡×š ×ª×¨×’×•× ×× ×’×œ×™×ª ×œ×¢×‘×¨×™×ª -->
        <div id="translatorEngHebScreen" class="translator-screen" style="display: none;">
            <button class="back-btn" onclick="goToLevelSelection()">ğŸ </button>
            
            <div class="translator-header">
                <h2>ğŸ‡ºğŸ‡¸â¡ï¸ğŸ‡®ğŸ‡± ×ª×¨×’×•× ×× ×’×œ×™×ª ×œ×¢×‘×¨×™×ª</h2>
                <p>×”×–×™× ×• ××™×œ×” ××• ××©×¤×˜ ×‘×× ×’×œ×™×ª ×œ×§×‘×œ×ª ×ª×¨×’×•× ×œ×¢×‘×¨×™×ª</p>
            </div>
            
            <div class="translator-content">
                <div class="translator-input-section">
                    <label for="engInput">English Text:</label>
                    <textarea id="engInput" placeholder="Enter English text here..." rows="4"></textarea>
                    <button onclick="translateEngToHeb()" class="translate-btn">ğŸ”„ Translate</button>
                </div>
                
                <div class="translator-output-section">
                    <label>×ª×¨×’×•× ×œ×¢×‘×¨×™×ª:</label>
                    <div id="hebOutput" class="translation-output">×”×ª×¨×’×•× ×™×•×¤×™×¢ ×›××Ÿ...</div>
                </div>
                
                <div class="quick-translate">
                    <h3>Quick Translation - Common Words:</h3>
                    <div class="quick-words-grid">
                        <button onclick="quickTranslateReverse('Hello', '×©×œ×•×')">Hello â†’ ×©×œ×•×</button>
                        <button onclick="quickTranslateReverse('Thank you', '×ª×•×“×”')">Thank you â†’ ×ª×•×“×”</button>
                        <button onclick="quickTranslateReverse('Please', '×‘×‘×§×©×”')">Please â†’ ×‘×‘×§×©×”</button>
                        <button onclick="quickTranslateReverse('Excuse me', '×¡×œ×™×—×”')">Excuse me â†’ ×¡×œ×™×—×”</button>
                        <button onclick="quickTranslateReverse('Yes', '×›×Ÿ')">Yes â†’ ×›×Ÿ</button>
                        <button onclick="quickTranslateReverse('No', '×œ×')">No â†’ ×œ×</button>
                        <button onclick="quickTranslateReverse('Bicycle', '××•×¤× ×™×')">Bicycle â†’ ××•×¤× ×™×</button>
                        <button onclick="quickTranslateReverse('School', '×‘×™×ª ×¡×¤×¨')">School â†’ ×‘×™×ª ×¡×¤×¨</button>
                        <button onclick="quickTranslateReverse('Water', '××™×')">Water â†’ ××™×</button>
                        <button onclick="quickTranslateReverse('Food', '××•×›×œ')">Food â†’ ××•×›×œ</button>
                        <button onclick="quickTranslateReverse('Family', '××©×¤×—×”')">Family â†’ ××©×¤×—×”</button>
                        <button onclick="quickTranslateReverse('Friend', '×—×‘×¨')">Friend â†’ ×—×‘×¨</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ××¡×š ×”×¡×‘×¨ ×¡×¤×¦×™×¤×™ -->
        <div id="explanationDetailScreen" class="explanation-detail-screen" style="display: none;">
            <button class="back-btn" onclick="showExplanations()">ğŸ”™</button>
            
            <div class="explanation-content">
                <h2 id="explanationTitle">×›×•×ª×¨×ª ×”×”×¡×‘×¨</h2>
                <p id="explanationDescription">×ª×™××•×¨ ×”×”×¡×‘×¨</p>
                
                <div class="explanation-section">
                    <h3>ğŸ“ ××‘× ×” ×”××©×¤×˜</h3>
                    <div id="explanationStructure" class="structure-box">
                        ××‘× ×” ×”××©×¤×˜ ×™×•×¤×™×¢ ×›××Ÿ
                    </div>
                </div>
                
                <div class="explanation-section">
                    <h3>ğŸ’¡ ×“×•×’×××•×ª</h3>
                    <div id="explanationExamples" class="examples-list">
                        <!-- ×“×•×’×××•×ª ×™×•×¤×™×¢×• ×›××Ÿ -->
                    </div>
                </div>
                
                <div class="explanation-section">
                    <h3>ğŸ“‹ ×›×œ×œ×™×</h3>
                    <div id="explanationRules" class="rules-list">
                        <!-- ×›×œ×œ×™× ×™×•×¤×™×¢×• ×›××Ÿ -->
                    </div>
                </div>
                
                <div class="explanation-section">
                    <h3>ğŸ”‘ ××™×œ×•×ª ××¤×ª×—</h3>
                    <div id="explanationKeywords" class="keywords-list">
                        <!-- ××™×œ×•×ª ××¤×ª×— ×™×•×¤×™×¢×• ×›××Ÿ -->
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button onclick="goToLevelSelection()" class="btn btn-primary">×—×–×¨×” ×œ××©×—×§</button>
                </div>
            </div>
        </div>

        <!-- ×¢××•×“ ×˜×¢×™× ×” -->
        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <p>×˜×•×¢×Ÿ...</p>
        </div>

        <!-- ×”×•×“×¢×•×ª -->
        <div id="messageContainer"></div>
    </div>

    <style>
        /* ×¢×™×¦×•×‘ ××¡×š ×”×”×¡×‘×¨×™× */
        .explanation-screen {
            background: linear-gradient(145deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            border: 5px solid #2196F3;
            text-align: center;
        }

        .explanation-header h2 {
            color: #1976D2;
            margin-bottom: 15px;
            font-size: 2.5em;
        }

        .explanation-header p {
            color: #424242;
            font-size: 1.2em;
            margin-bottom: 30px;
        }

        .explanations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .explanation-card {
            background: linear-gradient(145deg, #ffffff 0%, #f5f5f5 100%);
            border-radius: 20px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid #ddd;
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }

        .explanation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 25px rgba(0,0,0,0.2);
            border-color: #2196F3;
        }

        .explanation-card h3 {
            color: #1976D2;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .explanation-card p {
            color: #666;
            line-height: 1.6;
        }

        /* ×¢×™×¦×•×‘ ××¡×š ×”×¡×‘×¨ ×¡×¤×¦×™×¤×™ */
        .explanation-detail-screen {
            background: linear-gradient(145deg, #f3e5f5 0%, #e1bee7 100%);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            border: 5px solid #9C27B0;
        }

        .explanation-content h2 {
            color: #7B1FA2;
            text-align: center;
            margin-bottom: 15px;
            font-size: 2.5em;
        }

        .explanation-content > p {
            color: #424242;
            text-align: center;
            font-size: 1.2em;
            margin-bottom: 30px;
        }

        .explanation-section {
            margin: 25px 0;
            background: rgba(255,255,255,0.8);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .explanation-section h3 {
            color: #7B1FA2;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .structure-box {
            background: #f5f5f5;
            border: 2px solid #9C27B0;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            text-align: center;
            color: #424242;
        }

        .examples-list {
            list-style: none;
            padding: 0;
        }

        .example-item {
            background: #e8f5e8;
            border-right: 4px solid #4CAF50;
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            font-size: 1.1em;
        }

        .rules-list {
            list-style: none;
            padding: 0;
        }

        .rule-item {
            background: #fff3e0;
            border-right: 4px solid #FF9800;
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
        }

        .keywords-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .keyword-tag {
            background: #e3f2fd;
            border: 2px solid #2196F3;
            border-radius: 20px;
            padding: 8px 16px;
            font-weight: bold;
            color: #1976D2;
        }

        /* ×¢×™×¦×•×‘ ××¡×›×™ ×”×ª×¨×’×•× */
        .translator-screen {
            background: linear-gradient(145deg, #f1f8e9 0%, #c8e6c9 100%);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            border: 5px solid #4CAF50;
            text-align: center;
        }

        .translator-header h2 {
            color: #2E7D32;
            margin-bottom: 15px;
            font-size: 2.5em;
        }

        .translator-header p {
            color: #424242;
            font-size: 1.2em;
            margin-bottom: 30px;
        }

        .translator-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .translator-input-section {
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: right;
        }

        .translator-input-section label {
            display: block;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2E7D32;
            font-size: 1.2em;
        }

        .translator-input-section textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #4CAF50;
            border-radius: 10px;
            font-size: 1.1em;
            resize: vertical;
            font-family: inherit;
            text-align: right;
            direction: rtl;
        }

        .translator-input-section textarea:focus {
            outline: none;
            border-color: #2E7D32;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
        }

        .translate-btn {
            background: linear-gradient(145deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 15px rgba(76, 175, 80, 0.3);
        }

        .translate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 20px rgba(76, 175, 80, 0.4);
        }

        .translator-output-section {
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: right;
        }

        .translator-output-section label {
            display: block;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2E7D32;
            font-size: 1.2em;
        }

        .translation-output {
            background: #f5f5f5;
            border: 2px solid #4CAF50;
            border-radius: 10px;
            padding: 20px;
            font-size: 1.3em;
            min-height: 80px;
            color: #2c3e50;
            font-weight: 600;
            line-height: 1.6;
            direction: ltr;
            text-align: left;
        }

        .translation-output.hebrew {
            direction: rtl;
            text-align: right;
        }

        .quick-translate {
            background: rgba(255,255,255,0.8);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .quick-translate h3 {
            color: #2E7D32;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .quick-words-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .quick-words-grid button {
            background: linear-gradient(145deg, #E8F5E8 0%, #C8E6C9 100%);
            border: 2px solid #4CAF50;
            border-radius: 10px;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            font-weight: 600;
            color: #2E7D32;
        }

        .quick-words-grid button:hover {
            transform: translateY(-2px);
            background: linear-gradient(145deg, #C8E6C9 0%, #A5D6A7 100%);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        /* ×¨×¡×¤×•× ×¡×™×‘×™ ×œ××¡×›×™ ×ª×¨×’×•× */
        @media (max-width: 768px) {
            .translator-screen {
                padding: 20px;
                margin: 10px;
            }
            
            .translator-header h2 {
                font-size: 2em;
            }
            
            .quick-words-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <script>
        // ××©×ª× ×™× ×’×œ×•×‘×œ×™×™×
        let currentPlayer = null;
        let currentCategory = null;
        let currentLevel = null;
        let gameData = null;
        let playerProgress = null;

        // ×”××ª×—×•×œ ×™×ª×‘×¦×¢ ×‘-DOMContentLoaded ×”××—×¨ ×©××˜×¤×œ ×’× ×‘×ª×¨×’×•×

        // ×¤×•× ×§×¦×™×•×ª ×¢×–×¨
        function showMessage(text, type = 'success') {
            const container = document.getElementById('messageContainer');
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.textContent = text;
            container.appendChild(message);
            
            setTimeout(() => {
                if (container.contains(message)) {
                    container.removeChild(message);
                }
            }, 4000);
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showScreen(screenId) {
            const screens = ['playerSelection', 'levelSelection', 'gameScreen', 'resultScreen', 'explanationsScreen', 'explanationDetailScreen', 'translatorHebEngScreen', 'translatorEngHebScreen'];
            
            // ×”×¡×ª×¨×ª ×›×œ ×”××¡×›×™× ×¢× ×× ×™××¦×™×”
            screens.forEach(id => {
                const element = document.getElementById(id);
                if (element.style.display !== 'none') {
                    element.style.transition = 'all 0.3s ease-out';
                    element.style.opacity = '0';
                    element.style.transform = 'translateY(-20px)';
                    setTimeout(() => {
                        element.style.display = 'none';
                    }, 300);
                }
            });
            
            // ×”×¦×’×ª ×”××¡×š ×”× ×‘×—×¨ ×¢× ×× ×™××¦×™×”
            setTimeout(() => {
                const targetScreen = document.getElementById(screenId);
                targetScreen.style.display = 'block';
                targetScreen.style.opacity = '0';
                targetScreen.style.transform = 'translateY(20px)';
                
                // ×× ×™××¦×™×™×ª ×›× ×™×¡×”
                requestAnimationFrame(() => {
                    targetScreen.style.transition = 'all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                    targetScreen.style.opacity = '1';
                    targetScreen.style.transform = 'translateY(0)';
                });
                
                // ×”×•×¡×¤×ª ×§×œ××¡ ×× ×™××¦×™×” ×¡×¤×¦×™×¤×™ ×œ×›×œ ××¡×š
                setTimeout(() => {
                    if (screenId === 'gameScreen') {
                        targetScreen.classList.add('animate-bounce-in');
                    } else if (screenId === 'resultScreen') {
                        targetScreen.classList.add('animate-level-complete');
                        createConfetti();
                    } else {
                        targetScreen.classList.add('animate-fade-up');
                    }
                }, 100);
            }, 300);
            
            // ×”×¦×’×ª ×›×¤×ª×•×¨ ×”×—×œ×£ ××©×ª××© ×‘×›×œ ×”××¡×›×™× ×—×•×¥ ×××¡×š ×‘×—×™×¨×ª ×”×©×—×§×Ÿ
            const switchBtn = document.getElementById('switchUserBtn');
            if (screenId === 'playerSelection') {
                switchBtn.classList.remove('show');
            } else {
                switchBtn.classList.add('show');
            }
        }

        // ×¤×•× ×§×¦×™×•×ª × ×™×”×•×œ ×©×—×§× ×™×
        async function loadPlayers() {
            try {
                showLoading();
                const response = await fetch('/api/players');
                const data = await response.json();
                
                if (data.success) {
                    displayPlayers(data.players);
                } else {
                    showMessage('×©×’×™××” ×‘×˜×¢×™× ×ª ×©×—×§× ×™×', 'error');
                }
            } catch (error) {
                showMessage('×©×’×™××ª ×¨×©×ª ×‘×˜×¢×™× ×ª ×©×—×§× ×™×', 'error');
            } finally {
                hideLoading();
            }
        }

        function displayPlayers(players) {
            const container = document.getElementById('playersList');
            
            if (players.length === 0) {
                container.innerHTML = '<p style="color: #666; padding: 20px;">××™×Ÿ ×©×—×§× ×™× ×¨×©×•××™×. ×¦×¨×• ×©×—×§×Ÿ ×—×“×©!</p>';
                return;
            }
            
            container.innerHTML = players.map(player => `
                <div class="player-card" onclick="selectPlayer('${player.name}')">
                    <div class="player-info">
                        <h3>ğŸ‘¤ ${player.name}</h3>
                        <div class="player-stats">
                            ×¦×™×•×Ÿ ×›×•×œ×œ: ${player.total_score} | ××©×—×§×™×: ${player.games_played}
                        </div>
                    </div>
                    <div style="font-size: 2em;">â–¶ï¸</div>
                </div>
            `).join('');
        }

        async function createNewPlayer() {
            const nameInput = document.getElementById('newPlayerName');
            const name = nameInput.value.trim();
            
            if (!name) {
                showMessage('×× × ×”×–×™× ×• ×©× ×”×©×—×§×Ÿ', 'error');
                return;
            }
            
            try {
                showLoading();
                const response = await fetch('/api/create_player', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name: name })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage(data.message);
                    nameInput.value = '';
                    loadPlayers();
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                showMessage('×©×’×™××” ×‘×™×¦×™×¨×ª ×©×—×§×Ÿ', 'error');
            } finally {
                hideLoading();
            }
        }

        async function selectPlayer(playerName) {
            try {
                showLoading();
                const response = await fetch('/api/select_player', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name: playerName })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentPlayer = data.player;
                    loadPlayerProgress();
                    goToLevelSelection();
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                showMessage('×©×’×™××” ×‘×‘×—×™×¨×ª ×©×—×§×Ÿ', 'error');
            } finally {
                hideLoading();
            }
        }

        async function loadPlayerProgress() {
            try {
                const response = await fetch('/api/player_progress');
                const data = await response.json();
                
                if (data.success) {
                    playerProgress = data.progress;
                    updatePlayerDisplay(data.player_info);
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                showMessage('×©×’×™××” ×‘×˜×¢×™× ×ª ×”×ª×§×“××•×ª', 'error');
            }
        }

        function updatePlayerDisplay(playerInfo) {
            document.getElementById('playerGreeting').textContent = `×©×œ×•×, ${playerInfo.name}! ğŸ‘‹`;
            document.getElementById('playerStats').textContent = 
                `×¦×™×•×Ÿ ×›×•×œ×œ: ${playerInfo.total_score} | ××©×—×§×™×: ${playerInfo.games_played}`;
        }

        // ×¤×•× ×§×¦×™×•×ª ×”××©×—×§
        async function selectCategory(category) {
            currentCategory = category;
            
            const categoryNames = {
                'animals': '×—×™×•×ª ğŸ¾',
                'colors': '×¦×‘×¢×™× ğŸ¨',
                'food': '××•×›×œ ğŸ•',
                'family': '××©×¤×—×” ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦'
            };
            
            document.getElementById('selectedCategoryTitle').textContent = 
                `×¨××•×ª ${categoryNames[category]}`;
            
            await loadLevels(category);
            document.getElementById('levelsContainer').style.display = 'block';
        }

        async function loadLevels(category) {
            try {
                const response = await fetch(`/api/get_levels/${category}`);
                const data = await response.json();
                
                if (data.success) {
                    displayLevels(data.levels);
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                showMessage('×©×’×™××” ×‘×˜×¢×™× ×ª ×¨××•×ª', 'error');
            }
        }

        function displayLevels(levels) {
            const container = document.getElementById('levelsGrid');
            container.innerHTML = '';
            
            levels.forEach((level, index) => {
                setTimeout(() => {
                    let className = 'level-card';
                    let clickHandler = '';
                    let statusIcon = '';
                    
                    if (!level.is_unlocked) {
                        className += ' locked';
                        statusIcon = 'ğŸ”’';
                    } else {
                        clickHandler = `onclick="startGame(${level.level})"`;
                        if (level.is_completed) {
                            className += ' completed';
                            statusIcon = 'â­';
                        } else if (level.level === playerProgress[currentCategory].current_level) {
                            className += ' current';
                            statusIcon = 'â–¶ï¸';
                        } else {
                            statusIcon = 'â–¶ï¸';
                        }
                    }
                    
                    const levelCard = document.createElement('div');
                    levelCard.className = className + ' animate-slide-right';
                    levelCard.style.animationDelay = (index * 0.1) + 's';
                    
                    if (clickHandler) {
                        levelCard.onclick = () => startGame(level.level);
                    }
                    
                    levelCard.innerHTML = `
                        <div class="level-number">${level.level}</div>
                        <div class="level-icon" style="font-size: 2em; margin: 10px 0;">${statusIcon}</div>
                        <div class="level-title">${level.name}</div>
                        <div class="level-progress">${level.words_count} ××™×œ×™×</div>
                        ${!level.is_unlocked ? `<div style="font-size: 0.7em; color: #999; margin-top: 5px;">× ×“×¨×©: ${level.unlock_score} × ×§×•×“×•×ª</div>` : ''}
                    `;
                    
                    container.appendChild(levelCard);
                    
                    // ×”×•×¡×¤×ª ×× ×™××¦×™×” ×œ××¢×‘×¨ ×¢×›×‘×¨
                    if (level.is_unlocked) {
                        animateLevelCard(levelCard);
                    }
                }, index * 100);
            });
        }

        async function startGame(level) {
            currentLevel = level;
            
            try {
                showLoading();
                const response = await fetch('/api/start_game', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        category: currentCategory,
                        level: level
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    gameData = data;
                    showScreen('gameScreen');
                    document.getElementById('gameTitle').textContent = 
                        `${data.level_info.name} - ×¨××” ${level}`;
                    nextQuestion();
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                showMessage('×©×’×™××” ×‘×”×ª×—×œ×ª ×”××©×—×§', 'error');
            } finally {
                hideLoading();
            }
        }

        async function nextQuestion() {
            try {
                const response = await fetch('/api/next_question');
                const data = await response.json();
                
                if (data.success) {
                    displayQuestion(data);
                } else {
                    showMessage(data.error, 'error');
                    goToLevelSelection();
                }
            } catch (error) {
                showMessage('×©×’×™××” ×‘×˜×¢×™× ×ª ×©××œ×”', 'error');
            }
        }

        function displayQuestion(questionData) {
            const question = questionData.question;
            const answers = questionData.answers;
            const progress = questionData.game_progress;
            
            // ×¢×“×›×•×Ÿ ×”×ª××•× ×” ×•×”××™×œ×” ×”×¢×‘×¨×™×ª
            document.getElementById('wordImage').src = `/static/images/${question.image}`;
            document.getElementById('wordImage').alt = question.hebrew;
            document.getElementById('hebrewWord').textContent = question.hebrew;
            
            // ×¢×“×›×•×Ÿ ×”×ª×§×“××•×ª
            const progressPercent = (progress.answered / progress.total) * 100;
            document.getElementById('progressBar').style.width = `${progressPercent}%`;
            document.getElementById('gameProgress').textContent = 
                `×©××œ×” ${progress.answered + 1} ××ª×•×š ${progress.total} | ×¦×™×•×Ÿ: ${progress.score}`;
            
            // ×™×¦×™×¨×ª ×ª×©×•×‘×•×ª
            const answersGrid = document.getElementById('answersGrid');
            answersGrid.innerHTML = answers.map(answer => `
                <div class="answer-card" onclick="submitAnswer('${answer}')">
                    ${answer}
                </div>
            `).join('');
        }

        async function submitAnswer(answer) {
            // × ×˜×¨×•×œ ×›×¤×ª×•×¨×™ ×”×ª×©×•×‘×•×ª
            const answerCards = document.querySelectorAll('.answer-card');
            answerCards.forEach(card => {
                card.style.pointerEvents = 'none';
            });
            
            try {
                const response = await fetch('/api/submit_answer', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ answer: answer })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // ×”×“×’×©×ª ×”×ª×©×•×‘×” ×”× ×›×•× ×” ×•×”×©×’×•×™×”
                    answerCards.forEach(card => {
                        if (card.textContent.trim() === data.correct_answer) {
                            card.classList.add('correct');
                        } else if (card.textContent.trim() === answer && !data.is_correct) {
                            card.classList.add('wrong');
                        }
                    });
                    
                    // ×”××ª× ×” ×œ×× ×™××¦×™×”
                    setTimeout(() => {
                        if (data.game_finished) {
                            showGameResults(data);
                        } else {
                            nextQuestion();
                        }
                    }, 1500);
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                showMessage('×©×’×™××” ×‘×©×œ×™×—×ª ×ª×©×•×‘×”', 'error');
            }
        }

        function showGameResults(resultData) {
            const progress = resultData.game_progress;
            const successRate = Math.round((progress.answered > 0 ? 
                (resultData.game_progress.score / (progress.answered * 5)) * 100 : 0));
            
            // ×‘×—×™×¨×ª ×××•×’'×™ ×•×›×•×ª×¨×ª ×œ×¤×™ ×”×¦×œ×—×”
            let emoji = 'ğŸ‰';
            let title = '×›×œ ×”×›×‘×•×“!';
            
            if (successRate >= 90) {
                emoji = 'ğŸ†';
                title = '××•×©×œ×!';
            } else if (successRate >= 70) {
                emoji = 'â­';
                title = '××¢×•×œ×”!';
            } else if (successRate >= 50) {
                emoji = 'ğŸ‘';
                title = '×™×¤×” ×××•×“!';
            } else {
                emoji = 'ğŸ’ª';
                title = '×‘×¤×¢× ×”×‘××” ×™×”×™×” ×™×•×ª×¨ ×˜×•×‘!';
            }
            
            document.getElementById('resultEmoji').textContent = emoji;
            document.getElementById('resultTitle').textContent = title;
            document.getElementById('finalScore').textContent = progress.score;
            document.getElementById('correctAnswers').textContent = 
                `${Math.round((progress.score / 5))} ××ª×•×š ${progress.answered}`;
            document.getElementById('successRate').textContent = `${successRate}%`;
            
            if (resultData.level_completed) {
                showMessage('ğŸ‰ ×”×¨××” ×”×•×©×œ××” ×‘×”×¦×œ×—×”! ×¢×œ×™×ª ×œ×¨××” ×”×‘××”!');
            }
            
            showScreen('resultScreen');
        }

        async function exitGame() {
            if (confirm('×”×× ××ª× ×‘×˜×•×—×™× ×©×‘×¨×¦×•× ×›× ×œ×¦××ª ××”××©×—×§? ×”×”×ª×§×“××•×ª ×ª×™×©××¨.')) {
                try {
                    await fetch('/api/exit_game', { method: 'POST' });
                    goToLevelSelection();
                } catch (error) {
                    showMessage('×©×’×™××” ×‘×™×¦×™××” ××”××©×—×§', 'error');
                }
            }
        }

        // ×¤×•× ×§×¦×™×•×ª ×× ×™××¦×™×” ×“×•××•×ª ×œ×“×•××•×œ×™× ×’×•
        function createConfetti() {
            const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7'];
            const container = document.getElementById('resultScreen');
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 3 + 's';
                    confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                    container.appendChild(confetti);
                    
                    setTimeout(() => {
                        if (confetti.parentNode) {
                            confetti.parentNode.removeChild(confetti);
                        }
                    }, 5000);
                }, i * 100);
            }
        }

        function animateCorrectAnswer(element) {
            element.classList.add('animate-correct');
            element.style.background = 'linear-gradient(145deg, #c8e6c9 0%, #4CAF50 100%)';
            element.style.color = 'white';
            element.style.fontWeight = 'bold';
            
            // × ×™×’×•×Ÿ ×¦×œ×™×œ ×”×¦×œ×—×” (×× ×–××™×Ÿ)
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjl/1O/amz0IHm278OChYxELR5rg6q1YGAh4x+/ckDbfcK');
                audio.volume = 0.3;
                audio.play().catch(() => {}); // ×”×ª×¢×œ××•×ª ××©×’×™××•×ª ×¦×œ×™×œ
            } catch (e) {}
            
            // ×”×•×¡×¤×ª ××¤×§×˜ ×›×•×›×‘×™×
            const star = document.createElement('div');
            star.innerHTML = 'â­';
            star.style.position = 'absolute';
            star.style.top = '50%';
            star.style.left = '50%';
            star.style.transform = 'translate(-50%, -50%)';
            star.style.fontSize = '2em';
            star.style.zIndex = '10';
            star.classList.add('animate-star-burst');
            element.style.position = 'relative';
            element.appendChild(star);
            
            // ×¨×˜×˜ ×‘×˜×œ×¤×•×Ÿ
            if (navigator.vibrate) {
                navigator.vibrate([50, 25, 50]);
            }
            
            setTimeout(() => {
                if (star.parentNode) {
                    star.parentNode.removeChild(star);
                }
            }, 2000);
        }

        function animateWrongAnswer(element) {
            element.classList.add('animate-wrong');
            element.style.background = 'linear-gradient(145deg, #ffcdd2 0%, #f44336 100%)';
            element.style.color = 'white';
            element.style.fontWeight = 'bold';
            
            // × ×™×’×•×Ÿ ×¦×œ×™×œ ×©×’×™××” (×× ×–××™×Ÿ)
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRnQEAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YVAKAAC4uLi4QEBAQEBAQEBAQEBAQEBAQEBAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4QEBAQEBAQEBAQEBAQEBAQEBAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4QEBAQEBAQEBAQEBAQEBAQEBAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4QEBAQEBAQEBAQEBAQEBAQEBAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4QEBAQEBAQEBAQEBAQEBAQEBAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4QEBAQEBAQEBAQEBAQEBAQEBAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4QEBAQEBAQEBAQEBAQEBAQEBAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4QEBAQEBAQEBAQEBAQEBAQEBAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4QEBAQEBAQEBAQEBAQEBAQEBAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4QEBAQEBAQEBAQEBAQEBAQEBAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4QEBAQEBAQEBAQEBAQEBAQEBAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4QEBAQEBAQEBAQEBAQEBAQEBAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4QEBAQEBAQEBAQEBAQEBAQEBAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4QEBAQEBAQEBAQEBAQEBAQEBAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4QEBA');
                audio.volume = 0.2;
                audio.play().catch(() => {});
            } catch (e) {}
            
            // ×¨×˜×˜ ×—×–×§ ×™×•×ª×¨ ×œ×©×’×™××”
            if (navigator.vibrate) {
                navigator.vibrate([100, 50, 100, 50, 100]);
            }
        }

        function animateLevelCard(element) {
            element.style.transition = 'all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            element.addEventListener('mouseenter', () => {
                element.style.transform = 'translateY(-8px) scale(1.02)';
                element.style.boxShadow = '0 20px 40px rgba(0,0,0,0.25)';
            });
            
            element.addEventListener('mouseleave', () => {
                element.style.transform = 'translateY(0) scale(1)';
                element.style.boxShadow = '0 8px 25px rgba(255, 193, 7, 0.3)';
            });
        }

        function animateProgressBar(targetWidth) {
            const progressBar = document.getElementById('progressBar');
            let currentWidth = 0;
            const increment = targetWidth / 20;
            
            const animate = () => {
                if (currentWidth < targetWidth) {
                    currentWidth += increment;
                    progressBar.style.width = Math.min(currentWidth, targetWidth) + '%';
                    requestAnimationFrame(animate);
                }
            };
            
            animate();
        }

        // ×¢×“×›×•×Ÿ ×¤×•× ×§×¦×™×™×ª displayQuestion ×œ×”×•×¡×™×£ ×× ×™××¦×™×•×ª
        function displayQuestion(questionData) {
            const question = questionData.question;
            const answers = questionData.answers;
            const progress = questionData.game_progress;
            
            // ×× ×™××¦×™×” ×œ×ª××•× ×”
            const image = document.getElementById('wordImage');
            image.style.opacity = '0';
            image.style.transform = 'scale(0.8)';
            image.src = `/static/images/${question.image}`;
            image.alt = question.hebrew;
            
            image.onload = () => {
                image.style.transition = 'all 0.5s ease-out';
                image.style.opacity = '1';
                image.style.transform = 'scale(1)';
            };
            
            // ×× ×™××¦×™×” ×œ××™×œ×” ×”×¢×‘×¨×™×ª
            const hebrewWord = document.getElementById('hebrewWord');
            hebrewWord.style.opacity = '0';
            hebrewWord.style.transform = 'translateY(20px)';
            hebrewWord.textContent = question.hebrew;
            
            setTimeout(() => {
                hebrewWord.style.transition = 'all 0.4s ease-out';
                hebrewWord.style.opacity = '1';
                hebrewWord.style.transform = 'translateY(0)';
            }, 200);
            
            // ×¢×“×›×•×Ÿ ×”×ª×§×“××•×ª ×¢× ×× ×™××¦×™×”
            const progressPercent = (progress.answered / progress.total) * 100;
            setTimeout(() => {
                animateProgressBar(progressPercent);
            }, 400);
            
            document.getElementById('gameProgress').textContent = 
                `×©××œ×” ${progress.answered + 1} ××ª×•×š ${progress.total} | ×¦×™×•×Ÿ: ${progress.score}`;
            
            // ×™×¦×™×¨×ª ×ª×©×•×‘×•×ª ×¢× ×× ×™××¦×™×”
            const answersGrid = document.getElementById('answersGrid');
            answersGrid.innerHTML = '';
            
            answers.forEach((answer, index) => {
                setTimeout(() => {
                    const answerCard = document.createElement('div');
                    answerCard.className = 'answer-card animate-slide-right';
                    answerCard.textContent = answer;
                    answerCard.style.animationDelay = (index * 0.1) + 's';
                    answerCard.onclick = () => submitAnswer(answer);
                    answersGrid.appendChild(answerCard);
                }, index * 100);
            });
        }

        // ×¢×“×›×•×Ÿ ×¤×•× ×§×¦×™×™×ª submitAnswer ×œ×”×•×¡×™×£ ×× ×™××¦×™×•×ª
        async function submitAnswer(answer) {
            const answerCards = document.querySelectorAll('.answer-card');
            answerCards.forEach(card => {
                card.style.pointerEvents = 'none';
            });
            
            try {
                const response = await fetch('/api/submit_answer', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ answer: answer })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // ×× ×™××¦×™×•×ª ×œ×ª×©×•×‘×•×ª
                    answerCards.forEach(card => {
                        if (card.textContent.trim() === data.correct_answer) {
                            animateCorrectAnswer(card);
                        } else if (card.textContent.trim() === answer && !data.is_correct) {
                            animateWrongAnswer(card);
                        } else {
                            card.style.opacity = '0.5';
                        }
                    });
                    
                    // ×”××ª× ×” ×œ×× ×™××¦×™×”
                    setTimeout(() => {
                        if (data.game_finished) {
                            showGameResults(data);
                        } else {
                            nextQuestion();
                        }
                    }, 1500);
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                showMessage('×©×’×™××” ×‘×©×œ×™×—×ª ×ª×©×•×‘×”', 'error');
            }
        }

        // ×¤×•× ×§×¦×™×•×ª × ×™×•×•×˜
        function goToPlayerSelection() {
            // ××™×¤×•×¡ ×”××©×ª× ×™×
            currentPlayer = null;
            currentCategory = null;
            currentLevel = null;
            gameData = null;
            playerProgress = null;
            
            showScreen('playerSelection');
            loadPlayers();
            document.getElementById('levelsContainer').style.display = 'none';
        }

        function goToLevelSelection() {
            if (currentPlayer) {
                loadPlayerProgress();
                showScreen('levelSelection');
                document.getElementById('levelsContainer').style.display = 'none';
            } else {
                goToPlayerSelection();
            }
        }

        // ×¤×•× ×§×¦×™×•×ª ×”×¡×‘×¨×™×
        async function showExplanations() {
            try {
                showLoading();
                const response = await fetch('/api/explanations');
                const data = await response.json();
                
                if (data.success) {
                    displayExplanations(data.explanations);
                    showScreen('explanationsScreen');
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                showMessage('×©×’×™××” ×‘×˜×¢×™× ×ª ×”×¡×‘×¨×™×', 'error');
            } finally {
                hideLoading();
            }
        }

        function displayExplanations(explanations) {
            const container = document.getElementById('explanationsGrid');
            container.innerHTML = '';
            
            explanations.forEach((explanation, index) => {
                setTimeout(() => {
                    const card = document.createElement('div');
                    card.className = 'explanation-card animate-slide-right';
                    card.style.animationDelay = (index * 0.1) + 's';
                    card.onclick = () => showExplanationDetail(explanation.id);
                    
                    card.innerHTML = `
                        <h3>${explanation.title}</h3>
                        <p>${explanation.description}</p>
                    `;
                    
                    container.appendChild(card);
                }, index * 100);
            });
        }

        async function showExplanationDetail(explanationId) {
            try {
                showLoading();
                const response = await fetch(`/api/explanations/${explanationId}`);
                const data = await response.json();
                
                if (data.success) {
                    displayExplanationDetail(data.explanation);
                    showScreen('explanationDetailScreen');
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                showMessage('×©×’×™××” ×‘×˜×¢×™× ×ª ×”×¡×‘×¨', 'error');
            } finally {
                hideLoading();
            }
        }

        function displayExplanationDetail(explanation) {
            document.getElementById('explanationTitle').textContent = explanation.title;
            document.getElementById('explanationDescription').textContent = explanation.description;
            document.getElementById('explanationStructure').textContent = explanation.structure;
            
            // ×“×•×’×××•×ª
            const examplesContainer = document.getElementById('explanationExamples');
            examplesContainer.innerHTML = '';
            explanation.examples.forEach(example => {
                const div = document.createElement('div');
                div.className = 'example-item';
                div.textContent = example;
                examplesContainer.appendChild(div);
            });
            
            // ×›×œ×œ×™×
            const rulesContainer = document.getElementById('explanationRules');
            rulesContainer.innerHTML = '';
            explanation.rules.forEach(rule => {
                const div = document.createElement('div');
                div.className = 'rule-item';
                div.textContent = rule;
                rulesContainer.appendChild(div);
            });
            
            // ××™×œ×•×ª ××¤×ª×—
            const keywordsContainer = document.getElementById('explanationKeywords');
            keywordsContainer.innerHTML = '';
            explanation.keywords.forEach(keyword => {
                const span = document.createElement('span');
                span.className = 'keyword-tag';
                span.textContent = keyword;
                keywordsContainer.appendChild(span);
            });
        }

        // ×¢×“×›×•×Ÿ ×¤×•× ×§×¦×™×™×ª displayQuestion ×œ×˜×¤×œ ×’× ×‘××©×¤×˜×™×
        function displayQuestion(questionData) {
            const question = questionData.question;
            const answers = questionData.answers;
            const progress = questionData.game_progress;
            
            // ×‘×“×™×§×” ×× ×–×• ×©××œ×ª ××©×¤×˜ ××• ××™×œ×”
            if (question.type === 'sentence') {
                // ××©×¤×˜ - ×”×¡×ª×¨×ª ×”×ª××•× ×” ×•×”×¦×’×ª ×”×˜×§×¡×˜
                const image = document.getElementById('wordImage');
                image.style.display = 'none';
                
                const hebrewWord = document.getElementById('hebrewWord');
                hebrewWord.style.opacity = '0';
                hebrewWord.style.transform = 'translateY(20px)';
                hebrewWord.textContent = question.hebrew;
                hebrewWord.style.fontSize = '2em'; // ×’×•×“×œ ×§×˜×Ÿ ×™×•×ª×¨ ×œ××©×¤×˜×™×
                
                setTimeout(() => {
                    hebrewWord.style.transition = 'all 0.4s ease-out';
                    hebrewWord.style.opacity = '1';
                    hebrewWord.style.transform = 'translateY(0)';
                }, 200);
            } else {
                // ××™×œ×” - ×”×¦×’×ª ×”×ª××•× ×” ×›×¨×’×™×œ
                const image = document.getElementById('wordImage');
                image.style.display = 'block';
                image.style.opacity = '0';
                image.style.transform = 'scale(0.8)';
                image.src = `/static/images/${question.image}`;
                image.alt = question.hebrew;
                
                image.onload = () => {
                    image.style.transition = 'all 0.5s ease-out';
                    image.style.opacity = '1';
                    image.style.transform = 'scale(1)';
                };
                
                const hebrewWord = document.getElementById('hebrewWord');
                hebrewWord.style.opacity = '0';
                hebrewWord.style.transform = 'translateY(20px)';
                hebrewWord.textContent = question.hebrew;
                hebrewWord.style.fontSize = '3em'; // ×’×•×“×œ ×¨×’×™×œ ×œ××™×œ×™×
                
                setTimeout(() => {
                    hebrewWord.style.transition = 'all 0.4s ease-out';
                    hebrewWord.style.opacity = '1';
                    hebrewWord.style.transform = 'translateY(0)';
                }, 200);
            }
            
            // ×¢×“×›×•×Ÿ ×”×ª×§×“××•×ª ×¢× ×× ×™××¦×™×”
            const progressPercent = (progress.answered / progress.total) * 100;
            setTimeout(() => {
                animateProgressBar(progressPercent);
            }, 400);
            
            document.getElementById('gameProgress').textContent = 
                `×©××œ×” ${progress.answered + 1} ××ª×•×š ${progress.total} | ×¦×™×•×Ÿ: ${progress.score}`;
            
            // ×™×¦×™×¨×ª ×ª×©×•×‘×•×ª ×¢× ×× ×™××¦×™×”
            const answersGrid = document.getElementById('answersGrid');
            answersGrid.innerHTML = '';
            
            answers.forEach((answer, index) => {
                setTimeout(() => {
                    const answerCard = document.createElement('div');
                    answerCard.className = 'answer-card animate-slide-right';
                    answerCard.textContent = answer;
                    answerCard.style.animationDelay = (index * 0.1) + 's';
                    answerCard.onclick = () => submitAnswer(answer);
                    answersGrid.appendChild(answerCard);
                }, index * 100);
            });
        }

        // ×¤×•× ×§×¦×™×•×ª ×ª×¨×’×•×
        function showTranslatorHebEng() {
            showScreen('translatorHebEngScreen');
        }

        function showTranslatorEngHeb() {
            showScreen('translatorEngHebScreen');
        }

        // ××™×œ×•×Ÿ ×ª×¨×’×•× ××•×¨×—×‘
        const translationDictionary = {
            // ×‘×™×˜×•×™×™× ×‘×¡×™×¡×™×™×
            '×©×œ×•×': 'hello',
            '×ª×•×“×”': 'thank you',
            '×‘×‘×§×©×”': 'please',
            '×¡×œ×™×—×”': 'excuse me',
            '×›×Ÿ': 'yes',
            '×œ×': 'no',
            '×˜×•×‘': 'good',
            '×¨×¢': 'bad',
            '×’×“×•×œ': 'big',
            '×§×˜×Ÿ': 'small',
            
            // ××™×œ×•×ª ×™×¡×•×“
            '××™×': 'water',
            '××•×›×œ': 'food',
            '×‘×™×ª': 'house',
            '××©×¤×—×”': 'family',
            '××”×‘×”': 'love',
            '×—×‘×¨': 'friend',
            '×¡×¤×¨': 'book',
            '×œ×™××•×“': 'study',
            '×¢×‘×•×“×”': 'work',
            '×–××Ÿ': 'time',
            '×™×•×': 'day',
            '×œ×™×œ×”': 'night',
            '×‘×•×§×¨': 'morning',
            '×¢×¨×‘': 'evening',
            '×›×¡×£': 'money',
            '×“×œ×ª': 'door',
            '×—×œ×•×Ÿ': 'window',
            '×©×•×œ×—×Ÿ': 'table',
            '×›×™×¡×': 'chair',
            '××™×˜×”': 'bed',
            '××•×¤× ×™×™×': 'bicycle',
            '××•×¤× ×™×': 'bicycle',
            '×¨×›×‘': 'car',
            '××›×•× ×™×ª': 'car',
            '×‘×™×ª ×¡×¤×¨': 'school',
            '××•×¨×”': 'teacher',
            '×ª×œ××™×“': 'student',
            '×©×™×¢×•×¨': 'lesson',
            '×‘×—×™× ×”': 'exam',
            '×—×•×¤×©': 'vacation',
            
            // ×—×™×•×ª ××”××©×—×§
            '×›×œ×‘': 'dog',
            '×—×ª×•×œ': 'cat',
            '×¦×™×¤×•×¨': 'bird',
            '×“×’': 'fish',
            '×¤×¨×”': 'cow',
            '×¡×•×¡': 'horse',
            '×¢×›×‘×¨': 'mouse',
            '××¨×™×”': 'lion',
            '×¤×™×œ': 'elephant',
            '×§×•×£': 'monkey',
            '×“×•×‘': 'bear',
            '×–××‘': 'wolf',
            
            // ×¦×‘×¢×™×
            '××“×•×': 'red',
            '×›×—×•×œ': 'blue',
            '×¦×”×•×‘': 'yellow',
            '×™×¨×•×§': 'green',
            '×¡×’×•×œ': 'purple',
            '×›×ª×•×': 'orange',
            '×•×¨×•×“': 'pink',
            '×©×—×•×¨': 'black',
            '×œ×‘×Ÿ': 'white',
            '×—×•×': 'brown',
            '××¤×•×¨': 'gray',
            '×–×”×‘': 'gold',
            
            // ××•×›×œ
            '×ª×¤×•×—': 'apple',
            '×‘× × ×”': 'banana',
            '×œ×—×': 'bread',
            '×—×œ×‘': 'milk',
            '×¢×•×’×”': 'cake',
            '×¤×™×¦×”': 'pizza',
            '×’×œ×™×“×”': 'ice cream',
            '×‘×™×¦×”': 'egg',
            '×’×‘×™× ×”': 'cheese',
            '×‘×©×¨': 'meat',
            
            // ××©×¤×—×”
            '××‘×': 'father',
            '×××': 'mother',
            '××—': 'brother',
            '××—×•×ª': 'sister',
            '×¡×‘×': 'grandfather',
            '×¡×‘×ª×': 'grandmother',
            '×‘×Ÿ ×“×•×“': 'cousin',
            '×ª×™× ×•×§': 'baby',
            '×“×•×“': 'uncle',
            '×“×•×“×”': 'aunt',
            '×‘×Ÿ': 'son',
            '×‘×ª': 'daughter',
            
            // ×¤×¢×œ×™×
            '×œ×œ×›×ª': 'go',
            '×œ×‘×•×': 'come',
            '×œ××›×•×œ': 'eat',
            '×œ×©×ª×•×ª': 'drink',
            '×œ×™×©×•×Ÿ': 'sleep',
            '×œ×¨×•×¥': 'run',
            '×œ×©×—×§': 'play',
            '×œ×§×¨×•×': 'read',
            '×œ×›×ª×•×‘': 'write',
            '×œ×¨××•×ª': 'see',
            '×œ×©××•×¢': 'hear',
            '×œ×“×‘×¨': 'speak',
            '×œ×œ××•×“': 'learn',
            '×œ×œ××“': 'teach',
            '×œ×¢×‘×•×“': 'work',
            '×œ× ×¡×•×¢': 'travel',
            '×œ×©×™×¨': 'sing',
            '×œ×¨×§×•×“': 'dance',
            
            // ××¡×¤×¨×™×
            '××—×“': 'one',
            '×©× ×™×™×': 'two',
            '×©×œ×•×©×”': 'three',
            '××¨×‘×¢×”': 'four',
            '×—××™×©×”': 'five',
            '×©×™×©×”': 'six',
            '×©×‘×¢×”': 'seven',
            '×©××•× ×”': 'eight',
            '×ª×©×¢×”': 'nine',
            '×¢×©×¨×”': 'ten',
            
            // ×–×× ×™×
            '×”×™×•×': 'today',
            '××ª××•×œ': 'yesterday',
            '××—×¨': 'tomorrow',
            '×¢×›×©×™×•': 'now',
            '××–': 'then',
            '×©×¢×”': 'hour',
            '×“×§×”': 'minute',
            '×©× ×™×™×”': 'second',
            '×©×‘×•×¢': 'week',
            '×—×•×“×©': 'month',
            '×©× ×”': 'year'
        };

        // ×¤×•× ×§×¦×™×™×ª ×—×™×¤×•×© ×ª×¨×’×•× ×‘××™× ×˜×¨× ×˜ ×¢× ××§×•×¨×•×ª ××¨×•×‘×™×
        async function searchTranslationOnline(word, fromLang = 'he', toLang = 'en') {
            console.log(`××—×¤×© ×ª×¨×’×•× ×¢×‘×•×¨: "${word}" ×-${fromLang} ×œ-${toLang}`);
            
            // ×¨×©×™××ª ××§×•×¨×•×ª ×ª×¨×’×•×
            const translationSources = [
                {
                    name: 'MyMemory',
                    url: `https://api.mymemory.translated.net/get?q=${encodeURIComponent(word)}&langpair=${fromLang}|${toLang}`,
                    parse: (data) => data.responseStatus === 200 && data.responseData ? data.responseData.translatedText : null
                },
                {
                    name: 'GoogleTranslate',
                    url: `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${fromLang}&tl=${toLang}&dt=t&q=${encodeURIComponent(word)}`,
                    parse: (data) => Array.isArray(data) && data[0] && data[0][0] ? data[0][0][0] : null
                }
            ];
            
            // × ×™×¡×™×•×Ÿ ×ª×¨×’×•× ×××§×•×¨×•×ª ×©×•× ×™×
            for (const source of translationSources) {
                try {
                    console.log(`×× ×¡×” ×ª×¨×’×•× ×-${source.name}...`);
                    const response = await fetch(source.url);
                    const data = await response.json();
                    const translation = source.parse(data);
                    
                    if (translation) {
                        let cleanTranslation = translation.toLowerCase().trim();
                        
                        // × ×™×§×•×™ ×”×ª×¨×’×•×
                        cleanTranslation = cleanTranslation.replace(/[.,!?;:"'()]/g, '').trim();
                        
                        // ×‘×“×™×§×” ×©×”×ª×¨×’×•× ×œ× ×–×”×” ×œ××™×œ×” ×”××§×•×¨×™×ª ×•×œ× ×¨×™×§
                        if (cleanTranslation !== word.toLowerCase() && cleanTranslation.length > 0) {
                            console.log(`×ª×¨×’×•× × ××¦× ×‘-${source.name}: "${cleanTranslation}"`);
                            return cleanTranslation;
                        }
                    }
                } catch (error) {
                    console.log(`×©×’×™××” ×‘-${source.name}:`, error);
                    continue;
                }
            }
            
            
            // ×ª×™×§×•× ×™ ×ª×¨×’×•× ×™×“× ×™×™× ×œ×‘×™×˜×•×™×™× ×‘×¢×™×™×ª×™×™×
            const manualCorrections = {
                'he-en': {
                    '×¨××© ×××©×œ×”': 'prime minister',
                    '×¨××© ×”×××©×œ×”': 'prime minister',
                    '×¨××© ×”×××©×œ×” ×”×™×©×¨××œ×™': 'israeli prime minister',
                    '×¨××© ×”×××©×œ×” ×©×œ ×™×©×¨××œ': 'prime minister of israel',
                    '×¨××© ×¢×™×¨': 'mayor',
                    '×¨××© ×”×¢×™×¨': 'mayor',
                    '×¨××© ×”×¢×™×¨×™×”': 'mayor',
                    '×¨××©×™ ×¢×¨×™×': 'mayors',
                    'head government': 'prime minister', // ×ª×™×§×•×Ÿ ×œ×ª×¨×’×•× ×©×’×•×™
                    'head of government': 'prime minister',
                    'government head': 'prime minister',
                    'head city': 'mayor', // ×ª×™×§×•×Ÿ ×œ×ª×¨×’×•× ×©×’×•×™
                    'head of city': 'mayor',
                    'city head': 'mayor'
                },
                'en-he': {
                    'prime minister': '×¨××© ×××©×œ×”',
                    'israeli prime minister': '×¨××© ×”×××©×œ×” ×”×™×©×¨××œ×™',
                    'prime minister of israel': '×¨××© ×”×××©×œ×” ×©×œ ×™×©×¨××œ',
                    'mayor': '×¨××© ×¢×™×¨',
                    'mayors': '×¨××©×™ ×¢×¨×™×'
                }
            };
            
            const correctionKey = `${fromLang}-${toLang}`;
            if (manualCorrections[correctionKey] && manualCorrections[correctionKey][word.toLowerCase()]) {
                console.log(`×ª×™×§×•×Ÿ ×™×“× ×™ × ××¦×: ${manualCorrections[correctionKey][word.toLowerCase()]}`);
                return manualCorrections[correctionKey][word.toLowerCase()];
            }
            
            console.log('×œ× × ××¦× ×ª×¨×’×•× ××ª××™× ×‘××£ ××—×“ ××”××§×•×¨×•×ª');
            return null;
        }
        
        // ×¤×•× ×§×¦×™×™×ª ×ª×¨×’×•× ××©×•×¤×¨×ª ×¢× Morfix
        async function searchMorfixTranslation(word, fromLang = 'he', toLang = 'en') {
            try {
                // × ×™×¡×™×•×Ÿ ×’×™×©×” ×œ-Morfix API
                const morfixResponse = await fetch(`https://services.morfix.com/translationhebeng/getTranslation`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: word,
                        sourceLang: fromLang,
                        targetLang: toLang
                    })
                });
                
                if (morfixResponse.ok) {
                    const morfixData = await morfixResponse.json();
                    if (morfixData && morfixData.translation) {
                        return morfixData.translation.toLowerCase().trim();
                    }
                }
            } catch (error) {
                console.log('×©×’×™××” ×‘×’×™×©×” ×œ-Morfix:', error);
            }
            return null;
        }

        // ×¤×•× ×§×¦×™×™×ª ×”×•×¡×¤×ª ×ª×¨×’×•× ×—×“×© ×œ××™×œ×•×Ÿ
        function addToTranslationDictionary(hebrew, english) {
            translationDictionary[hebrew.toLowerCase()] = english.toLowerCase();
            reverseTranslationDictionary[english.toLowerCase()] = hebrew;
            
            // ×©××™×¨×” ×‘-localStorage ×œ×©×™××•×© ×¢×ª×™×“×™
            try {
                const savedTranslations = JSON.parse(localStorage.getItem('customTranslations') || '{}');
                savedTranslations[hebrew.toLowerCase()] = english.toLowerCase();
                localStorage.setItem('customTranslations', JSON.stringify(savedTranslations));
            } catch (e) {
                console.log('×©×’×™××” ×‘×©××™×¨×ª ×ª×¨×’×•×:', e);
            }
        }

        // ×¤×•× ×§×¦×™×” ×œ×ª×¨×’×•× ×‘×™×˜×•×™×™× ×©×œ××™× ×œ×¤× ×™ ×ª×¨×’×•× ××™×œ×” ××—×¨ ××™×œ×”
        function translateCompleteExpressions(text, dictionary) {
            let result = text;
            
            // ×¨×©×™××ª ×‘×™×˜×•×™×™× ×©×œ××™× ×œ×—×™×¤×•×© (××”××¨×•×š ×œ×§×¦×¨ ×›×“×™ ×œ×˜×¤×œ ×§×•×“× ×‘×‘×™×˜×•×™×™× ×”××¨×•×›×™×)
            const expressions = Object.keys(dictionary).sort((a, b) => b.length - a.length);
            
            for (const expr of expressions) {
                if (result.includes(expr)) {
                    console.log(`× ××¦× ×‘×™×˜×•×™ ×©×œ×: "${expr}" -> "${dictionary[expr]}"`);
                    // ×”×—×œ×¤×” ×™×©×™×¨×” ×©×œ ×”×‘×™×˜×•×™ ×”×©×œ×
                    result = result.replace(new RegExp(expr, 'gi'), dictionary[expr]);
                }
            }
            
            return result;
        }

        // ×˜×¢×™× ×ª ×ª×¨×’×•××™× ×©××•×¨×™× ×-localStorage
        function loadSavedTranslations() {
            try {
                const savedTranslations = JSON.parse(localStorage.getItem('customTranslations') || '{}');
                Object.entries(savedTranslations).forEach(([hebrew, english]) => {
                    translationDictionary[hebrew] = english;
                    reverseTranslationDictionary[english] = hebrew;
                });
            } catch (e) {
                console.log('×©×’×™××” ×‘×˜×¢×™× ×ª ×ª×¨×’×•××™× ×©××•×¨×™×:', e);
            }
        }

        async function translateHebToEng() {
            const input = document.getElementById('hebInput').value.trim();
            const output = document.getElementById('engOutput');
            
            if (!input) {
                output.textContent = '×× × ×”×–×™× ×• ×˜×§×¡×˜ ×œ×ª×¨×’×•×';
                return;
            }
            
            // ×”×¦×’×ª ×”×•×“×¢×ª ×˜×¢×™× ×”
            output.textContent = '××ª×¨×’×... ğŸ”„';
            output.style.color = '#2196F3';
            
            // × ×™×§×•×™ ×•×”×›× ×ª ×”×˜×§×¡×˜ ×œ×ª×¨×’×•×
            let cleanInput = input.toLowerCase();
            
            // ×§×•×“× × ×—×¤×© ×‘×™×˜×•×™×™× ×©×œ××™× ×‘××™×œ×•×Ÿ
            let translatedText = translateCompleteExpressions(cleanInput, translationDictionary);
            
            // ×× ×›×œ ×”×˜×§×¡×˜ ×ª×•×¨×’× - × ×¦×™×’ ××ª ×”×ª×•×¦××”
            if (translatedText !== cleanInput) {
                output.textContent = translatedText;
                output.style.color = '#4CAF50';
                
                // ×× ×™××¦×™×”
                output.style.transform = 'scale(0.8)';
                setTimeout(() => {
                    output.style.transition = 'transform 0.3s ease';
                    output.style.transform = 'scale(1)';
                }, 100);
                
                return; // ×¡×™×™× - ×›×œ ×”×˜×§×¡×˜ ×ª×•×¨×’×
            }
            
            // ×× ×œ× - × ×ª×¨×’× ××™×œ×” ××—×¨ ××™×œ×”
            cleanInput = cleanInput.replace(/[.,!?;:"'()]/g, ' ');
            const words = cleanInput.split(/\s+/).filter(word => word.length > 0);
            const translatedWords = [];
            const unknownWords = [];
            
            for (const word of words) {
                let translated = null;
                
                // ×—×™×¤×•×© ×™×©×™×¨ ×‘××™×œ×•×Ÿ
                if (translationDictionary[word]) {
                    translated = translationDictionary[word];
                } else {
                    // ×—×™×¤×•×© ××™×œ×™× ×“×•××•×ª ××• ×—×œ×§×™×•×ª
                    for (const [hebrewWord, englishWord] of Object.entries(translationDictionary)) {
                        if (hebrewWord.includes(word) || word.includes(hebrewWord)) {
                            translated = englishWord;
                            break;
                        }
                    }
                    
                    // ×× ×œ× × ××¦× ×ª×¨×’×•× - × ×¡×” ×‘×œ×™ ××•×ª×™×•×ª ×¡×™×•×
                    if (!translated && word.length > 2) {
                        const baseWord = word.substring(0, word.length - 1);
                        if (translationDictionary[baseWord]) {
                            translated = translationDictionary[baseWord];
                        }
                    }
                }
                
                if (translated) {
                    translatedWords.push(translated);
                } else {
                    // ×× ×œ× × ××¦× ×‘××™×œ×•×Ÿ - × ×—×¤×© ×‘××™× ×˜×¨× ×˜
                    unknownWords.push(word);
                    translatedWords.push(`[××—×¤×©...]`);
                }
            }
            
            // ×”×¦×’×ª ×ª×•×¦××” ×¨××©×•× ×™×ª
            let result = translatedWords.join(' ');
            
            // ×©×—×–×•×¨ ×‘×™×˜×•×™×™× ××ª×•×¨×’××™×
            result = restoreTranslatedExpressions(result);
            
            output.textContent = result;
            
            // ×—×™×¤×•×© ×‘××™× ×˜×¨× ×˜ ×œ××™×œ×™× ×œ× ×™×“×•×¢×•×ª
            if (unknownWords.length > 0) {
                for (let i = 0; i < unknownWords.length; i++) {
                    const word = unknownWords[i];
                    try {
                        // ×§×•×“× × ×‘×“×§ ×× ×–×” ×‘×™×˜×•×™ ×©××¦×¨×™×š ×ª×™×§×•×Ÿ ××™×•×—×“
                        let onlineTranslation = null;
                        
                        // ×ª×™×§×•× ×™× ××™×•×—×“×™× ×œ×‘×™×˜×•×™×™× ×™×“×•×¢×™×
                        if (word === '×¨××© ×××©×œ×”' || word === '×¨××© ×”×××©×œ×”') {
                            onlineTranslation = 'prime minister';
                            console.log('×ª×™×§×•×Ÿ ××™×•×—×“: ×¨××© ×××©×œ×” = prime minister');
                        } else if (word === '×¨××© ×¢×™×¨' || word === '×¨××© ×”×¢×™×¨' || word === '×¨××© ×”×¢×™×¨×™×”') {
                            onlineTranslation = 'mayor';
                            console.log('×ª×™×§×•×Ÿ ××™×•×—×“: ×¨××© ×¢×™×¨ = mayor');
                        } else {
                            // ×—×™×¤×•×© ×¨×’×™×œ ×‘××™× ×˜×¨× ×˜
                            onlineTranslation = await searchTranslationOnline(word, 'he', 'en');
                            
                            // ×× ×”×ª×•×¦××” ×”×™× ×ª×¨×’×•× ×©×’×•×™ - × ×ª×§×Ÿ ××•×ª×”
                            if (onlineTranslation === 'head government' || onlineTranslation === 'government head') {
                                onlineTranslation = 'prime minister';
                                console.log('×ª×™×§×•×Ÿ ×ª×¨×’×•× ×©×’×•×™: head government -> prime minister');
                            } else if (onlineTranslation === 'head city' || onlineTranslation === 'city head' || onlineTranslation === 'head of city') {
                                onlineTranslation = 'mayor';
                                console.log('×ª×™×§×•×Ÿ ×ª×¨×’×•× ×©×’×•×™: head city -> mayor');
                            }
                        }
                        
                        if (onlineTranslation) {
                            // ×”×•×¡×¤×ª ×”×ª×¨×’×•× ×œ××™×œ×•×Ÿ
                            addToTranslationDictionary(word, onlineTranslation);
                            
                            // ×¢×“×›×•×Ÿ ×”×ª×•×¦××”
                            result = result.replace('[××—×¤×©...]', onlineTranslation);
                            output.textContent = result;
                            
                            // ×”×•×“×¢×ª ×”×¦×œ×—×”
                            showMessage(`× ××¦× ×ª×¨×’×•× ×—×“×©: ${word} = ${onlineTranslation}`, 'success');
                        } else {
                            // ×× ×œ× × ××¦× ×ª×¨×’×•× ×‘××™× ×˜×¨× ×˜
                            result = result.replace('[××—×¤×©...]', `[${word}]`);
                            output.textContent = result;
                        }
                    } catch (error) {
                        result = result.replace('[××—×¤×©...]', `[${word}]`);
                        output.textContent = result;
                    }
                }
            }
            
            // ×¦×‘×™×¢×ª ×”×ª×•×¦××” ×”×¡×•×¤×™×ª
            if (result.includes('[') && !result.includes('[××—×¤×©...]')) {
                output.style.color = '#ff6b6b'; // ××“×•× ×œ×ª×¨×’×•× ×—×œ×§×™
                setTimeout(() => {
                    showMessage('×—×œ×§ ××”××™×œ×™× ×œ× × ××¦××• ×’× ×‘××™× ×˜×¨× ×˜. ×”××™×œ×™× ×©×‘[×¡×•×’×¨×™×™×] ×œ× ×ª×•×¨×’××•.', 'info');
                }, 500);
            } else if (!result.includes('[')) {
                output.style.color = '#4CAF50'; // ×™×¨×•×§ ×œ×ª×¨×’×•× ××œ×
            } else {
                output.style.color = '#2196F3'; // ×›×—×•×œ ×‘×–××Ÿ ×—×™×¤×•×©
            }
            
            // ×× ×™××¦×™×”
            output.style.transform = 'scale(0.8)';
            setTimeout(() => {
                output.style.transition = 'transform 0.3s ease';
                output.style.transform = 'scale(1)';
            }, 100);
        }

        async function translateEngToHeb() {
            const input = document.getElementById('engInput').value.trim();
            const output = document.getElementById('hebOutput');
            
            if (!input) {
                output.textContent = 'Please enter text to translate';
                return;
            }
            
            // ×”×¦×’×ª ×”×•×“×¢×ª ×˜×¢×™× ×”
            output.textContent = 'Translating... ğŸ”„';
            output.style.color = '#2196F3';
            
            // × ×™×§×•×™ ×•×”×›× ×ª ×”×˜×§×¡×˜ ×œ×ª×¨×’×•×
            let cleanInput = input.toLowerCase();
            
            // ×§×•×“× × ×—×¤×© ×‘×™×˜×•×™×™× ×©×œ××™× ×‘××™×œ×•×Ÿ ×”×¤×•×š
            let translatedText = translateCompleteExpressions(cleanInput, reverseTranslationDictionary);
            
            // ×× ×›×œ ×”×˜×§×¡×˜ ×ª×•×¨×’× - × ×¦×™×’ ××ª ×”×ª×•×¦××”
            if (translatedText !== cleanInput) {
                output.textContent = translatedText;
                output.classList.add('hebrew');
                output.style.color = '#4CAF50';
                
                // ×× ×™××¦×™×”
                output.style.transform = 'scale(0.8)';
                setTimeout(() => {
                    output.style.transition = 'transform 0.3s ease';
                    output.style.transform = 'scale(1)';
                }, 100);
                
                return; // ×¡×™×™× - ×›×œ ×”×˜×§×¡×˜ ×ª×•×¨×’×
            }
            
            // ×× ×œ× - × ×ª×¨×’× ××™×œ×” ××—×¨ ××™×œ×”
            cleanInput = cleanInput.replace(/[.,!?;:"'()]/g, ' ');
            const words = cleanInput.split(/\s+/).filter(word => word.length > 0);
            const translatedWords = [];
            const unknownWords = [];
            
            for (const word of words) {
                let translated = null;
                
                // ×—×™×¤×•×© ×™×©×™×¨ ×‘××™×œ×•×Ÿ ×”×¤×•×š
                if (reverseTranslationDictionary[word]) {
                    translated = reverseTranslationDictionary[word];
                } else {
                    // ×—×™×¤×•×© ××™×œ×™× ×“×•××•×ª
                    for (const [englishWord, hebrewWord] of Object.entries(reverseTranslationDictionary)) {
                        if (englishWord.includes(word) || word.includes(englishWord)) {
                            translated = hebrewWord;
                            break;
                        }
                    }
                    
                    // × ×¡×” ×‘×œ×™ s ×‘×¡×•×£ (×¨×‘×™× ×‘×× ×’×œ×™×ª)
                    if (!translated && word.endsWith('s') && word.length > 2) {
                        const singular = word.slice(0, -1);
                        if (reverseTranslationDictionary[singular]) {
                            translated = reverseTranslationDictionary[singular];
                        }
                    }
                    
                    // × ×¡×” ×‘×œ×™ ed ×‘×¡×•×£ (×¢×‘×¨ ×‘×× ×’×œ×™×ª)
                    if (!translated && word.endsWith('ed') && word.length > 3) {
                        const base = word.slice(0, -2);
                        if (reverseTranslationDictionary[base]) {
                            translated = reverseTranslationDictionary[base];
                        }
                    }
                    
                    // × ×¡×” ×‘×œ×™ ing ×‘×¡×•×£ (×”×•×•×” ××ª××©×š)
                    if (!translated && word.endsWith('ing') && word.length > 4) {
                        const base = word.slice(0, -3);
                        if (reverseTranslationDictionary[base]) {
                            translated = reverseTranslationDictionary[base];
                        }
                    }
                }
                
                if (translated) {
                    translatedWords.push(translated);
                } else {
                    // ×× ×œ× × ××¦× ×‘××™×œ×•×Ÿ - × ×—×¤×© ×‘××™× ×˜×¨× ×˜
                    unknownWords.push(word);
                    translatedWords.push(`[××—×¤×©...]`);
                }
            }
            
            // ×”×¦×’×ª ×ª×•×¦××” ×¨××©×•× ×™×ª
            let result = translatedWords.join(' ');
            
            // ×©×—×–×•×¨ ×‘×™×˜×•×™×™× ××ª×•×¨×’××™×
            result = restoreTranslatedExpressions(result);
            
            output.textContent = result;
            output.classList.add('hebrew');
            
            // ×—×™×¤×•×© ×‘××™× ×˜×¨× ×˜ ×œ××™×œ×™× ×œ× ×™×“×•×¢×•×ª
            if (unknownWords.length > 0) {
                for (let i = 0; i < unknownWords.length; i++) {
                    const word = unknownWords[i];
                    try {
                        // ×ª×™×§×•× ×™× ××™×•×—×“×™× ×œ×‘×™×˜×•×™×™× ×™×“×•×¢×™× ××× ×’×œ×™×ª ×œ×¢×‘×¨×™×ª
                        let onlineTranslation = null;
                        
                        if (word === 'prime minister' || word === 'prime-minister') {
                            onlineTranslation = '×¨××© ×××©×œ×”';
                            console.log('×ª×™×§×•×Ÿ ××™×•×—×“: prime minister = ×¨××© ×××©×œ×”');
                        } else if (word === 'mayor') {
                            onlineTranslation = '×¨××© ×¢×™×¨';
                            console.log('×ª×™×§×•×Ÿ ××™×•×—×“: mayor = ×¨××© ×¢×™×¨');
                        } else if (word === 'president') {
                            onlineTranslation = '× ×©×™×';
                        } else if (word === 'minister') {
                            onlineTranslation = '×©×¨';
                        } else if (word === 'government') {
                            onlineTranslation = '×××©×œ×”';
                        } else {
                            // ×—×™×¤×•×© ×¨×’×™×œ ×‘××™× ×˜×¨× ×˜
                            onlineTranslation = await searchTranslationOnline(word, 'en', 'he');
                        }
                        
                        if (onlineTranslation) {
                            // ×”×•×¡×¤×ª ×”×ª×¨×’×•× ×œ××™×œ×•×Ÿ
                            addToTranslationDictionary(onlineTranslation, word);
                            
                            // ×¢×“×›×•×Ÿ ×”×ª×•×¦××”
                            result = result.replace('[××—×¤×©...]', onlineTranslation);
                            output.textContent = result;
                            
                            // ×”×•×“×¢×ª ×”×¦×œ×—×”
                            showMessage(`Found new translation: ${word} = ${onlineTranslation}`, 'success');
                        } else {
                            // ×× ×œ× × ××¦× ×ª×¨×’×•× ×‘××™× ×˜×¨× ×˜
                            result = result.replace('[××—×¤×©...]', `[${word}]`);
                            output.textContent = result;
                        }
                    } catch (error) {
                        result = result.replace('[××—×¤×©...]', `[${word}]`);
                        output.textContent = result;
                    }
                }
            }
            
            // ×¦×‘×™×¢×ª ×”×ª×•×¦××” ×”×¡×•×¤×™×ª
            if (result.includes('[') && !result.includes('[××—×¤×©...]')) {
                output.style.color = '#ff6b6b'; // ××“×•× ×œ×ª×¨×’×•× ×—×œ×§×™
                setTimeout(() => {
                    showMessage('Some words were not found even online. Words in [brackets] were not translated.', 'info');
                }, 500);
            } else if (!result.includes('[')) {
                output.style.color = '#4CAF50'; // ×™×¨×•×§ ×œ×ª×¨×’×•× ××œ×
            } else {
                output.style.color = '#2196F3'; // ×›×—×•×œ ×‘×–××Ÿ ×—×™×¤×•×©
            }
            
            // ×× ×™××¦×™×”
            output.style.transform = 'scale(0.8)';
            setTimeout(() => {
                output.style.transition = 'transform 0.3s ease';
                output.style.transform = 'scale(1)';
            }, 100);
        }

        function quickTranslate(hebrew, english) {
            document.getElementById('hebInput').value = hebrew;
            document.getElementById('engOutput').textContent = english;
            document.getElementById('engOutput').style.color = '#4CAF50';
            document.getElementById('engOutput').style.fontWeight = 'bold';
        }

        function quickTranslateReverse(english, hebrew) {
            document.getElementById('engInput').value = english;
            document.getElementById('hebOutput').textContent = hebrew;
            document.getElementById('hebOutput').style.color = '#4CAF50';
            document.getElementById('hebOutput').style.fontWeight = 'bold';
            document.getElementById('hebOutput').classList.add('hebrew');
        }

        // Event listeners
        document.getElementById('newPlayerName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                createNewPlayer();
            }
        });

        // Event listeners ×œ×ª×¨×’×•×
        document.addEventListener('DOMContentLoaded', function() {
            // ×˜×¢×™× ×ª ×ª×¨×’×•××™× ×©××•×¨×™× ×•×˜×¢×™× ×ª ×©×—×§× ×™×
            loadSavedTranslations();
            loadPlayers();
            
            // ×ª×•×¡×¤×ª event listeners ×¨×§ ××—×¨×™ ×©×”×“×£ × ×˜×¢×Ÿ
            setTimeout(() => {
                const hebInput = document.getElementById('hebInput');
                const engInput = document.getElementById('engInput');
                
                if (hebInput) {
                    hebInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            translateHebToEng();
                        }
                    });
                }
                
                if (engInput) {
                    engInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            translateEngToHeb();
                        }
                    });
                }
            }, 1000);
        });
    </script>
</body>
</html>